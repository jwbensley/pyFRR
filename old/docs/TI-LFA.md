
# WIP: TI-LFA IS A WIP AND NOT YET FINISHED!

## Overview

The TI-LFA module tries to calculate the lowest cost path from the source node to the destination node, avoid the failed first hop link(s) or node(s).

Like the LFA and rLFA modules, the pre-failure best path could be a single path, and when that is unavailable there could be multiple paths tied for the 2nd lowest cost path between source and destination nodess (ECMP). The reverse situation is also possible, the lowest cost path pre-failure is two or more ECMP paths an afer they have *all equal cost paths have failed* then the next best path post-failure may be a single path. This means that the calculated TI-LFA path may route traffic from a single failed path over multiple ECMP backup paths, or that traffic from multiple best paths is routed post-failure over a single backup path. This is important to note because it can be a concern for capacity planning, and for packet reordring. Equally there may be multiple best paths and multiple 2nd best paths, meaning that *only after all paths* in a set of primary ECMP paths have failed is traffic routed over a different set of backup ECMP paths. Again, congest can occur in the primary set of ECMP paths waiting for the last path to fail. This model does not take these cases into consideration.

The TI-LFA module initially choses the lowest cost post-failure path(s) to protect the failued best path(s). This is based on metric/cost. There can be many backup ECMP paths which weren't possible when using LFA or rFLA, which can take crazy paths all over the network due to using only a single metric value (such as only bandwidth or only latency). You need to feed in whatever metric is most important/relevant to your network.

The output of this module is the list of SIDs that need to be inserted before the active SID in the header list, so that the active SID now becomes the first SID in the repair path(s). Consideration is required when pushing the SID list(s) generated by this module on to SR packets. See RFC sections 6.1/6.2/6.3 to understand if the active segment needs to be popped or kept for example.

### ToDo

"The TI-LFA module then reduces the TI-LFA candidate list by choosing the lowest cost backup paths which also require the fewest number of SIDs, to reduce the number of SIDs that need to be included. As a generalisation, the larger the stack of SIDs required, the more indirect the backup path. This avoids longer more indirect paths, which despite having an equal cost as other backup paths, are probably undesired. It also reduced the MTU required and increase node eligability (not all nodes in a network can impose the same number of SIDs)." - Not implemented yet.

### Limitations

FlexAgo for Prefix-SIDs is not supported. If a path from the repair node to the destination node is modified by a local policy on a node (e.g., a constrained path which isn't the default shortest path is applied to the destination node's "Node-SID" [a Prefix-SID]), that path is ignored, only the default shortest path is evaluated by this module.

